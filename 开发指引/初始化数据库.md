[link]: http://hzerodoc.saas.hand-china.com/zh/docs/development-guide/backend-develop-guid/demo/init_db/

## 创建用户、数据库

```sql
CREATE USER 'hzero'@'%' IDENTIFIED BY "hzero";
CREATE DATABASE todo_service DEFAULT CHARACTER SET utf8;
GRANT ALL PRIVILEGES ON todo_service.* TO hzero@'%';
FLUSH PRIVILEGES;
```

## 设计表结构

- 先使用Excel设计 `todo_user` 及 `todo_task` 表结构。Excel 设计参考：[TODO表设计](http://hzerodoc.saas.hand-china.com/files/docs/development-guide/backend-develop-guid/demo/TODO表设计.xls)设计完成后，将相应数据库的脚本拷贝到 `todo_service` 库下执行，创建表。
- 设计完成后，将相应数据库的脚本拷贝到 `todo_service` 库下执行，创建表。

## 导出Groovy脚本

HZERO 采用`Liquibase` + `groovy` 的方式对数据库管理，便于后续同步各个环境数据库结构以及升级。 [Liquibase 官网](https://docs.liquibase.com/change-types/community/home.html)。

使用代码生成器工具生成 Groovy 脚本。

## 同步表结构

将表结构同步到其它环境时，可使用数据安装工具来安装数据库，将 groovy 脚本导出后，放到本地 `hzero-resource` 项目的 groovy 目录下，然后启动工具安装数据库即可。

- 将导出的 groovy 脚本放到 `~/hzero-resource/groovy/todo_service` 目录下

- 修改 `~/hzero-resource/docs/mapping/service-mapping.xml`，加入 todo_service 的数据库信息

  ```xml
  <service name="hzero-todo-service" filename="todo_service" schema="todo_service" description="TODO示例服务"/>
  ```

- 通过 `database-init.sh` 启动安装工具

- 访问安装工具页面，选择 todo_service 安装

- 生成 groovy 之后，如果表结构有变更，首先更新 Excel 表设计，再向 groovy 脚本中添加 changeSet 来添加变更记录，再使用安装工具来同步其它环境。

## 验证表结构

登录数据库，查询现有的表结构。

```bash
mysql> show tables;
+---------------------------------------+
| Tables_in_todo_service |
+---------------------------------------+
| DATABASECHANGELOG                     |
| DATABASECHANGELOGLOCK                 |
| TODO_TASK                             |
| TODO_USER                             |
+---------------------------------------+
5 rows in set (0.00 sec)
```

## 项目数据库配置

在`pom.xml` 文件中添加数据库操作相关依赖。

```xml
<dependency>
    <groupId>org.hzero.starter</groupId>
    <artifactId>hzero-starter-mybatis-mapper</artifactId>
</dependency>
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
</dependency>
```

在项目的 `application.yml` 文件中添加数据库连接信息：

```yml
spring:
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:mysql://db.hzero.org:3306/todo_service?useUnicode=true&characterEncoding=utf-8&useSSL=false}
    username: ${SPRING_DATASOURCE_USERNAME:hzero}
    password: ${SPRING_DATASOURCE_PASSWORD:hzero}

# MyBatis Mapper 扫描
mybatis:
  mapperLocations: classpath*:/mapper/*.xml
  configuration:
    mapUnderscoreToCamelCase: true
```

项目根目录下执行命令。项目正常启动，则数据库连接配置正常。

```bash
$ mvn clean spring-boot:run
```