### Loombook

```java
@ApiModel(value = "XXX")
@ToString
@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Builder
@FieldNameConstants(prefix = "FIELD_")
@VersionAudit
@ModifyAudit
@JsonInclude(value = JsonInclude.Include.NON_NULL)
@Table(name = "XXX_XXX")
```

### mysql查询数据库中包含某字段（列名）的所有表

\#是查询数据库名为`dzbbsdb`的数据库中所有包含`username`列名的表信息。

```mysql
SELECT   TABLE_NAME '表名',TABLE_SCHEMA '数据库名',ORDINAL_POSITION '顺序',COLUMN_NAME '字段',DATA_TYPE '类型' ,CHARACTER_OCTET_LENGTH '字节长',IF(COLUMN_KEY='PRI',"√","") '主键',IF(EXTRA='auto_increment',"√","") '自增长' ,IF(IS_NULLABLE='YES',"√","") '空',CHARACTER_SET_NAME '编码',COLUMN_DEFAULT '默认值',COLUMN_COMMENT '说明' 
FROM information_schema.COLUMNS WHERE TABLE_SCHEMA='dzbbs' AND COLUMN_NAME='username'
```

### 使用Mybatis的时候，特殊字符需进行转义,如

\&lt;\&gt;  <>
\&amp;   & 
\&apos;  '
\&quot;  "

### Mybatis事务回滚

```java
TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
throw new UtilException("XXX"); // 详情见UtilException的使用
```

①这两个一般不在一起使用，一般项目建议使用 `throw new` 进行自定义抛出异常， `TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();` 只有 `catch` 的时候为了让异常继续往上抛出，才需要。但是目前大多数情况下建议使用 `throw new` 进行自定义抛出异常，将报错信息提示出来

②你用了抛出异常，但是没有加事务注解 `@Transactional(rollbackFor = Exception.class)`

```java
@Transactional
@ApiOperation("上移")
@RequestMapping(value = "/upExamLib", method = RequestMethod.PUT)
public Result upExamLib(@Valid @RequestBody HomeUpForm homeForm) {
	ExamLib examLib = examLibService.getExamLibById(homeForm.getId());
	ExamLib examLib1 = examLibService.getExamLibById(homeForm.getUid());
	if (null == examLib || null == examLib1) {
		return ResultUtil.sendErrorMessage("上移失败！");
	}
	boolean flag = examLibService.updateExamLibSort(examLib1.getId(), examLib.getSort());
	boolean flag1 = examLibService.updateExamLibSort(examLib.getId(), examLib1.getSort());
	if (flag && flag1) {
		return ResultUtil.sendSuccessMessage("上移成功！");
	} else {
		TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
		return ResultUtil.sendErrorMessage("上移失败！");
	}
}
```

或者是使用 `throw new` 抛出异常：

```java
@Override
@Transactional(rollbackFor = UtilException.class)
public String deleteByBankVO(List<PartnerBankDTO> partnerBankDTOList) {
	for (PartnerBankDTO partnerBankDTO : partnerBankDTOList) {
		// 银行账户信息存在性校验、重复性校验
		PartnerBankcountInfo partnerBankcountInfo1 = partnerBankcountInfoRepository.selectByPrimaryKey(partnerBankDTO);
		if (partnerBankcountInfo1 == null) {
			throw new UtilException(ReturnMessage.CSMMSG006);
		} else if (!partnerBankcountInfo1.getPartnerId().equals(partnerBankDTO.getPartnerId())) {
			throw new UtilException(ReturnMessage.CSMMSG009);
		}
		// 根据银行账户ID，删除币种信息
		partnerCurrencyInfoMapper.deleteByBankcountId(partnerBankDTO.getBankcountId());
		// 银行账户信息的删除与校验
		int flag = partnerBankcountInfoRepository.deleteByPrimaryKey(partnerBankDTO);
		if (flag != 1) {
			throw new UtilException(ReturnMessage.CSMMSG005);
		}
	}
	return ReturnMessage.CSMMSG002;
}
```

### 全局变量定义

```java
@ApiModel("返回消息")
@Data
@AllArgsConstructor
@NoArgsConstructor
public class ReturnMessage {

    public static final String CSMMSG001 = "必填字段不能为空";
    public static final String CSMMSG002 = "保存成功";
    public static final String CSMMSG003 = "保存失败";
    public static final String CSMMSG004 = "录入信息与已有信息重复";

    @ApiModelProperty("消息编码")
    private String value;
}
```

### 两个同类对象之间的赋值

```java
/**
 * javaBean的工具类
 *
 * @author shengzhou.kong@hand-china.com 2020/08/18 17:37
 */
public class PojoUtils {

    /**
     * 赋值给同类对象
     * 将origin属性注入到destination中
     *
     * @param [origin, destination]
     * @return void
     * @author shengzhou.kong@hand-china.com 17:38 2020-08-18
     **/
    public <T> void mergeObject(T origin, T destination) {
        if (origin == null || destination == null)
            return;
        if (!origin.getClass().equals(destination.getClass()))
            return;

        Field[] fields = origin.getClass().getDeclaredFields();
        for (int i = 0; i < fields.length; i++) {
            try {
                fields[i].setAccessible(true);
                Object value = fields[i].get(origin);
                if (null != value && !"".equals(value)) {
                    fields[i].set(destination, value);
                }
                fields[i].setAccessible(false);
            } catch (Exception e) {
            }
        }
    }
}
```

### Java-MyBatis：MyBatis 中 in 的用法

```java
<select id="dynamicForeachTest" resultType="Blog">
          select * from t_blog where id in
       <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
               #{item}       
       </foreach>    
</select>
```

### Java-MyBatis：bind

```java
<bind name="partnerNameBlike" value="'%'+partnerName+'%'"/>
```

### TenantId

```java
Long tenantId = DetailsHelper.getUserDetails().getTenantId();
```

### 编码规则

```java
private static final String HMDM_MERCHANT_CODE_RULE = "HMDM.MERCHANT";
private Logger logger = LoggerFactory.getLogger(getClass());

@Autowired
private CodeRuleBuilder codeRuleBuilder;

String partnerCode = codeRuleBuilder.generateCode(HMDM_MERCHANT_CODE_RULE, null);
logger.info("===generateCode:{}", partnerCode);
```

### UtilException

```java
throw new UtilException("你好，{}中奖金额{}元！", "张三", 500);
```

### 值集

```java
@LovValue(
	lovCode = "HZERO.28250.ORDER.COMPANY", meaningField = "companyNameMeaning"
)
private String companyName;
@Transient
private String companyNameMeaning;

//API
@ProcessLovValue(targetField = BaseConstants.FIELD_BODY)
```

### .gitignore（移出.idea，移至主目录下）

add : `右键 -> Git -> add`

commit : `右条栏 -> commit -> 选中所要提交的文件 -> 添加备注信息 -> commit`

push : `右键 -> Git -> Repository -> push`

```java
E:\SpringBoot-module\.gitignore
```

### 页签

```java
E:\SpringBoot-module\ExpDecHeadMapper.xml
```

```sql
<sql id="objectColumns">
	partner_id, partner_type, tenant_id, object_version_number, creation_date,
	created_by, last_updated_by, last_update_date, ATTRIBUTE_CATEGORY, ATTRIBUTE1,
	ATTRIBUTE2, ATTRIBUTE3, ATTRIBUTE4, ATTRIBUTE5, ATTRIBUTE6, ATTRIBUTE7, ATTRIBUTE8,
	ATTRIBUTE9, ATTRIBUTE10, ATTRIBUTE11, ATTRIBUTE12, ATTRIBUTE13, ATTRIBUTE14, ATTRIBUTE15
</sql>
<select id="selectByPartnerId" resultMap="BaseResultMap">
	select
	<include refid="objectColumns"/>
	from hmdm_partner_type_info
	where partner_id = #{partnerId,jdbcType=BIGINT}
</select>
```

### java中判断Object对象类型

```java
Object param = params.get(i);
if (param instanceof Integer) {
	int value = ((Integer) param).intValue();
    prepStatement.setInt(i + 1, value);
} else if (param instanceof String) {
    String s = (String) param;
    prepStatement.setString(i + 1, s);
} else if (param instanceof Double) {
    double d = ((Double) param).doubleValue();
    prepStatement.setDouble(i + 1, d);
} else if (param instanceof Float) {
    float f = ((Float) param).floatValue();
    prepStatement.setFloat(i + 1, f);
} else if (param instanceof Long) {
    long l = ((Long) param).longValue();
    prepStatement.setLong(i + 1, l);
} else if (param instanceof Boolean) {
    boolean b = ((Boolean) param).booleanValue();
    prepStatement.setBoolean(i + 1, b);
} else if (param instanceof Date) {
    Date d = (Date) param;
    prepStatement.setDate(i + 1, (Date) param);
}  
```

### 在Mybatis的xml文件调用java类的方法

```sql
'${@全类名@静态方法名(待处理参数变量)}'
'${@org.hzero.mdm.domain.utils.FuzzyCheck@delSpeChar(传递参数名称)}'
```

```sql
where name like '${@全类名@静态方法名(待处理参数变量)}'
SELECT * FROM USER WHERE name='${@org.apache.commons.lang3@StringUtils(name)}'
```

### in vs exists

```sql
--这条语句适用于a表比b表大的情况
select * from ecs_goods a where cat_id in(select cat_id from ecs_category);
--这条语句适用于b表比a表大的情况
select * from ecs_goods a where EXISTS(select cat_id from ecs_category b where a.cat_id = b.cat_id);
```

### concat

```sql
--字段 or 输入信息
concat('%',concat(partner_valid_name,'%'))
```

### 去除特殊字符

```java
String regEx = "[\n`~!@#$%^&*()+=|{}':;',\\[\\].<>/?~！@#￥%……&*（）——+|{}【】‘；：”“’。， 、？]";
// 想要替换成的字符串
String tmp = "";
Pattern p = Pattern.compile(regEx);
Matcher m = p.matcher(partnerName);
String newString = m.replaceAll(tmp).trim();
```

### validator唯一性校验API

```java
@ApiOperation(value = "")
@Permission(level = ResourceLevel.ORGANIZATION)
@PostMapping("/validator")
public ResponseEntity<Boolean> validator(@PathVariable("organizationId") Long organizationId,
                                         @ApiParam(value = "校验参数", required = true)
                                         @RequestBody(required = true) Dict validatorParam) {
	Assert.notNull(validatorParam, "校验参数不能为空");
	// {"unique":[{"bankNum":"455"}]} 获取{"bankNum":"455"}
	Dict params = validatorParam.getPathDict("unique[0]");
	String bankNum = params.getStr("bankNum");
	return Results.success(partnerBankcountInfoService.validator(bankNum));
}
```

### 取LOV中的Meaning

条件：

- 必须是独立值集
- 值集必须公开

```java
Lov lov = Dict.getLovInfo("HCTM_SHIP_TYPE", "1");
String meaning = lov.getMeaning();
```

### Token校验

```java
// Token校验
SecurityTokenHelper.validToken(partnerBankDTOList);
```

### 关联Bean

```java
1.VO implements SecurityToken 或 DTO implements SecurityToken
2.DTO加个属性 private String _token;
3.加个方法
@Override
public Class<? extends SecurityToken> associateEntityClass() {
    return Act.class;
}
4.Act.class换成需要关联的Bean
```

### List\<Bean\>的Token校验

`SecurityTokenHelper.validToken(partnerBankDTOList);` 放在 Controller 层

系统会自动地遍历List\<Bean\>，并逐条记录进行Token校验

### @Autowired的替换

```java
@RequiredArgsConstructor(onConstructor = @__(@Autowired))
private final XXX XXX;
```

### 日志输出

```java
// 声明：
@Slf4j
// 或
private final Logger log = LoggerFactory.getLogger(getClass());
```

```java
log.info("------------------------XXX:{}------------------------", XXX);
```

### 常量、枚举类型数据的设置

```java
E:\SpringBoot-module\Constants.java
```

### @NotNull / @NotBlank / @LovValue 检验报错信息

```java
@NotNull(groups = Group1.class, message = "公司Code不能为空")
@NotBlank(groups = Group1.class, message = "公司Code不能为空")
@LovValue(lovCode = "", meaningField = "", groups = Group1.class, message = "公司Code不存在")
```

### mapper.xml - resultMap

注意：

- `column` 与 `property` 需要一致，符合命名规则
- 若数据库中的字段与 `column` 不一致时，可以使用别名 `as` 来处理

```java
<resultMap id="BaseResultMap" type="org.hzero.mdm.domain.entity.PartnerBasicInfo">
	<result column="area_meaning" property="areaMeaning" jdbcType="VARCHAR"/>
</resultMap>
```

```java
<sql id="objectColumns">
	hrt.region_name area_meaning
</sql>
```

### SQL值集的使用

```java
<resultMap id="BaseResultMap" type="org.hzero.mdm.domain.entity.PartnerBasicInfo">
	------------
	<result column="area" property="area" jdbcType="VARCHAR"/>
	<result column="area_meaning" property="areaMeaning" jdbcType="VARCHAR"/>
	<result column="is_ipo" property="isIpo" jdbcType="VARCHAR"/>
	------------
</resultMap>
```

```java
<sql id="objectColumns">
	-------------
	bi.open_date, bi.close_date, bi.business_type, bi.business_char, bi.area, hrt.region_name area_meaning,
	bi.is_ipo, bi.ipo_type, bi.ipo_code, bi.status, bi.combine_to, bi.business_scope,
	-------------
</sql>
```

```java
<select id="selectByConditions" resultType="org.hzero.mdm.api.dto.PartnerBasicDTO">
	select
	<include refid="objectColumns"/>
	from hmdm_partner_basic_info bi left join hzero_platform.hpfm_region hr on bi.area = hr.region_id
	<bind name="lang" value="@io.choerodon.mybatis.helper.LanguageHelper@language()"/>
	left join hzero_platform.hpfm_region_tl hrt on hr.region_id = hrt.region_id AND hrt.lang = #{lang}
	<where>
		-----------
	</where>
</select>
```

### 更新指定字段

```java
logisticsPlanRepository.updateOptional(XXX, logisticsPlanLogisticsPlan.FIELD_PORT_DEPT);
```

### 在项目中查询时间段的sql语句(时间类型为datetime或date)(数据库中的时间类型)

```sql
<if test="beginTime!=null and beginTime!=''">
    <![CDATA[   and DATE_FORMAT(tr.add_time, '%Y-%m-%d')>=  DATE_FORMAT(#{beginTime}, '%Y-%m-%d')   ]]>
</if>
<if test="endTime!=null and endTime!=''">
    <![CDATA[  and DATE_FORMAT(tr.add_time, '%Y-%m-%d') <= DATE_FORMAT(#{endTime}, '%Y-%m-%d')    ]]>
</if>
```

>`MySQL DATE_FORMAT()` 函数用于以不同的格式显示日期/时间数据
>
>语法：`DATE_FORMAT(date,format)`
>
>*date* 参数是合法的日期。*format* 规定日期/时间的输出格式。

>在 XML 元素中，`<` 和 `&` 是非法的：
>
>`<` 会产生错误，因为解析器会把该字符解释为新元素的开始
>
>`&` 也会产生错误，因为解析器会把该字符解释为字符实体的开始
>
>在 mapper 文件中写 sql 语句时，遇到特殊字符时，如：`<` 等，建议使用 `<![CDATA[ sql 语句 ]]>` 标记，将 sql 语句包裹住，不被解析器解析

### 在项目中查询时间段的sql语句(时间类型为varchar)(数据库中的时间类型)

```sql
<if test="beginTime!=null and beginTime!=''">
　　AND tm.add_time&gt;=#{beginTime} 
</if> 
<if test="endTime!=null and endTime!=''">
 　　AND tm.add_time &lt;=#{endTime} 
</if>
```

```sql
&lt;小于号  <      &gt; 大于号>
```

### Java验证是否为纯数字

```java
// 不带小数
Pattern pattern = Pattern.compile("^-?[0-9]+");
// 带小数的
Pattern pattern = Pattern.compile("^[-+]?[0-9]+(\\.[0-9]+)?$");
if(pattern.matcher(str).matches()){
	//数字
	return true;
} else {
	//非数字
	return false;
}
```

### 日期的校验

```java
boolean convertSuccess=true;
SimpleDateFormat format = new SimpleDateFormat("yyyy/MM/dd");
try {
	// 设置lenient为false. 否则SimpleDateFormat会比较宽松地验证日期，比如2007/02/29会被接受，并转换成2007/03/01
	format.setLenient(false);
	format.parse(String.valueOf(DATETIME));
} catch (ParseException e) {
	// e.printStackTrace();
	// 如果throw java.text.ParseException或者NullPointerException，就说明格式不对
	convertSuccess=false;
}
```

### 指定遇到date按照这种格式转换

```java
ObjectMapper objectMapper = new ObjectMapper();
// 指定遇到date按照这种格式转换："yyyy-MM-dd"、"yyyy-MM-dd HH:mm:ss"
SimpleDateFormat fmt = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
objectMapper.setDateFormat(fmt);
// 赋值ItemPrice对象
ItemPrice itemPrice = itemPriceService.transferCode(objectMapper.readValue(data, ItemPrice.class));
```

### 错误输出

```java
try {
	...
} catch (Exception e) {
	e.printStackTrace();
	throw new UtilException(e.getMessage());
}
```

### FastJson-JsonFormat

```java
// 指定变量存储的数据格式
@ApiModelProperty(value = "合同日期从，格式为：YYYY-MM-DD hh:mm:ss")
@JsonFormat(pattern = "yyyy-MM-dd")
@NotNull(message = "合同日期从不能为空")
private Date contractDateFrom;
```

### Dict —— 适用于中间变量

```java
Dict dict = Dict.create();
dict.convertFieldUpperCase(); // 驼峰
dict.convertFieldUnderLine(); // 下划线
dict.handleLovMeaning(); // 值集字段转换
dict.getLovInfo(); // 获取指定的Lov含义
dict.getLovList(); // 获取LovCode中的所有key-value
```

